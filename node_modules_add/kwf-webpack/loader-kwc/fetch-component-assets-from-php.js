'use strict';
const process = require('child_process');

let cache;
module.exports = function() {
    if (cache) return cache;
    var ret = process.spawnSync('vps', ['component-introspection', 'get-component-assets']);
    if (ret.status) {
        return new Error("get-component-scss-config failed");
    }
    cache = JSON.parse(ret.stdout);
    return cache;
}


/*
async version
var process = require('child_process');

var componentAssets;
var componentAssetsCallbacks;
module.exports = function getComponentAssets(cb) {
    if (componentAssets) {
        cb.call(this, componentAssets);
        return;
    }
    if (!componentAssetsCallbacks) {
        componentAssetsCallbacks = [];
        var cmd = 'vps ';
        //console.log(cmd);
        var p = process.exec(cmd, (function (error, stdout, stderr) {
            if (error) {
                throw new Error(stderr);
            }
            componentAssets = JSON.parse(stdout);
            componentAssetsCallbacks.forEach(function(cb) {
                cb.call(this, componentAssets);
            }, this);
        }).bind(this));
    }
    componentAssetsCallbacks.push(cb);
};
*/