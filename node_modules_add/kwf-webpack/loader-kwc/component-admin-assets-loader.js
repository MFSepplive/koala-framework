'use strict';
var path = require("path");
var loaderUtils = require("loader-utils");
var fs = require("fs");

module.exports = function(source, map) {

    this.cacheable();

    const componentAssets = JSON.parse(fs.readFileSync(process.cwd()+'/build/component/assets.json'));
    this.addDependency(process.cwd()+'/build/component/assets.json');

    let ret = '';
    for (let pkg in componentAssets) {
        let cmps = componentAssets[pkg];
        for (let cmp in cmps) {
            let dep = cmps[cmp].assetsAdmin.dep;
            let files = cmps[cmp].assetsAdmin.files;
            dep.forEach(function(asset) {
                ret += "require('"+require.resolve('../loader/ini-loader')+"?dep="+asset+"!');\n";
            }, this);
            files.forEach(function(asset) {
                if (asset.match(/\.js$/)) {
                    ret += "require('script-loader!" + asset + "');\n";
                } else {
                    ret += "require('"+asset+"');\n";
                }
            }, this);
        }
    }
    return ret;
};
