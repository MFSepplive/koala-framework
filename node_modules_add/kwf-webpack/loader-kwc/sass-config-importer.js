const fs = require('fs');
const jsToSassString = require('json-sass/lib/jsToSassString');

module.exports = function(url, prev, done) {
    if (url == 'config') {
        var m = this.options.data.match(/\$componentClass: "([^"]+)"/);
        if (!m) {
            return null;
        }

        var componentClass = m[1];

        var configPath = 'build/component/scss-config-'+componentClass+'.json';
        if (!fs.existsSync(configPath)) {
            throw new Error("Can't find scss config for "+componentClass);
        }
        var config = JSON.parse(fs.readFileSync(configPath, 'utf-8'));

        //TODO use config.masterFiles
        return {
            contents: '$config: '+jsToSassString(config.config)+';'
        };
    }
    return null;
};
