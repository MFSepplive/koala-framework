var process = require('child_process');
var jsToSassString = require('json-sass/lib/jsToSassString');

module.exports = function(url, prev, done) {
    if (url == 'config') {
        var m = this.options.data.match(/\$componentClass: "([^"]+)"/);
        if (!m) {
            return null;
        }

        var componentClass = m[1];

        var cmd = 'vps component-introspection get-component-scss-config --class='+componentClass;
        //console.log('get-component-scss-config', componentClass);
        var ret = process.spawnSync('vps', ['component-introspection', 'get-component-scss-config', '--class='+componentClass]);
        if (ret.status) {
            return new Error("get-component-scss-config failed");
        }
        ret = JSON.parse(ret.stdout);
        //TODO use ret.masterFiles
        return {
            contents: '$config: '+jsToSassString(ret.config)+';'
        };
    }
    return null;
};
