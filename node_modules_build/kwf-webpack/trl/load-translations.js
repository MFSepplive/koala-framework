var gettextParser = require("gettext-parser");
var fs = require('fs');

module.exports = function(filenames, languages)
{
    var translations = {};
    filenames.forEach(filename => {
        languages.forEach(lang => {
            const f = filename.replace('[language]', lang);
            if (fs.existsSync(f)) {
                var po = gettextParser.po.parse(fs.readFileSync(f, 'utf-8'));

                if (!translations[lang]) translations[lang] = {};
                for (let context in po.translations) {
                    if (!translations[lang][context]) translations[lang][context] = {};

                    for (let msgid in po.translations[context]) {
                        if (!translations[lang][context][msgid]) {
                            translations[lang][context][msgid] = po.translations[context][msgid];
                        }
                    }
                }
            }
        });
    });

    return translations;
}
