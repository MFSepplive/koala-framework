var fs = require("fs");
var ini = require('ini');
module.exports = function(source, map) {

    this.cacheable();
    var callback = this.async();
    if (!callback) {
        this.emitError("Only async supported");
        return;
    }

    fs.readFile('config.ini', 'utf-8', function(err, contents) {
        var deps = ini.parse(contents);
        if (!deps.production) {
            throw new Error("production section not found in config.ini");
        }
        if (!deps.production.googleMapsApiKey) {
            throw new Error("googleMapsApiKey not found in config.ini");
        }
        var ret = "module.exports = "+JSON.stringify(deps.production.googleMapsApiKey)+";";
        callback(null, ret);
    });
};
